/*
 * jScrollPane - v2.0.0beta9 - 2011-01-31
 * http://jscrollpane.kelvinluck.com/
 *
 * Copyright (c) 2010 Kelvin Luck
 * Dual licensed under the MIT and GPL licenses.
 */
(function(b,a,c){b.fn.jScrollPane=function(f){function d(E,O){var aA,Q=this,Y,ak,w,am,T,Z,z,r,aB,aG,aw,j,J,i,k,aa,U,aq,X,u,B,ar,af,an,H,m,au,az,y,ax,aK,g,L,aj=true,P=true,aJ=false,l=false,C,av,ap=E.clone().empty(),ac=b.fn.mwheelIntent?"mwheelIntent.jsp":"mousewheel.jsp";aK=E.css("paddingTop")+" "+E.css("paddingRight")+" "+E.css("paddingBottom")+" "+E.css("paddingLeft");g=(parseInt(E.css("paddingLeft"),10)||0)+(parseInt(E.css("paddingRight"),10)||0);function at(aT){var aR,aS,aN,aP,aO,aM,aL,aQ;aA=aT;if(Y===c){aL=E.scrollTop();aQ=E.scrollLeft();E.css({overflow:"hidden",padding:0});ak=E.innerWidth()+g;w=E.innerHeight();E.width(ak);Y=b('<div class="jspPane" />').css("padding",aK).append(E.children());am=b('<div class="jspContainer" />').css({width:ak+"px",height:w+"px"}).append(Y).appendTo(E)}else{E.css("width","");aM=E.innerWidth()+g!=ak||E.outerHeight()!=w;if(aM){ak=E.innerWidth()+g;w=E.innerHeight();am.css({width:ak+"px",height:w+"px"})}if(!aM&&L==T&&Y.outerHeight()==Z){E.width(ak);return}L=T;Y.css("width","");E.width(ak);am.find(">.jspVerticalBar,>.jspHorizontalBar").remove().end()}aR=Y.clone().css("position","absolute");aS=b('<div style="width:1px; position: relative;" />').append(aR);b("body").append(aS);T=Math.max(Y.outerWidth(),aR.outerWidth());aS.remove();Z=Y.outerHeight();z=T/ak;r=Z/w;aB=r>1;aG=z>1;if(!(aG||aB)){E.removeClass("jspScrollable");Y.css({top:0,width:am.width()-g});o();F();R();x();ai()}else{E.addClass("jspScrollable");aN=aA.maintainPosition&&(J||aa);if(aN){aP=aE();aO=aC()}aH();A();G();if(aN){N(aP,false);M(aO,false)}K();ag();ao();if(aA.enableKeyboardNavigation){S()}if(aA.clickOnTrack){q()}D();if(aA.hijackInternalLinks){n()}}if(aA.autoReinitialise&&!ax){ax=setInterval(function(){at(aA)},aA.autoReinitialiseDelay)}else{if(!aA.autoReinitialise&&ax){clearInterval(ax)}}aL&&E.scrollTop(0)&&M(aL,false);aQ&&E.scrollLeft(0)&&N(aQ,false);E.trigger("jsp-initialised",[aG||aB])}function aH(){if(aB){am.append(b('<div class="jspVerticalBar" />').append(b('<div class="jspCap jspCapTop" />'),b('<div class="jspTrack" />').append(b('<div class="jspDrag" />').append(b('<div class="jspDragTop" />'),b('<div class="jspDragBottom" />'))),b('<div class="jspCap jspCapBottom" />')));U=am.find(">.jspVerticalBar");aq=U.find(">.jspTrack");aw=aq.find(">.jspDrag");if(aA.showArrows){ar=b('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",aF(0,-1)).bind("click.jsp",aD);af=b('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",aF(0,1)).bind("click.jsp",aD);if(aA.arrowScrollOnHover){ar.bind("mouseover.jsp",aF(0,-1,ar));af.bind("mouseover.jsp",aF(0,1,af))}al(aq,aA.verticalArrowPositions,ar,af)}u=w;am.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){u-=b(this).outerHeight()});aw.hover(function(){aw.addClass("jspHover")},function(){aw.removeClass("jspHover")}).bind("mousedown.jsp",function(aL){b("html").bind("dragstart.jsp selectstart.jsp",aD);aw.addClass("jspActive");var s=aL.pageY-aw.position().top;b("html").bind("mousemove.jsp",function(aM){V(aM.pageY-s,false)}).bind("mouseup.jsp mouseleave.jsp",ay);return false});p()}}function p(){aq.height(u+"px");J=0;X=aA.verticalGutter+aq.outerWidth();Y.width(ak-X-g);if(U.position().left===0){Y.css("margin-left",X+"px")}}function A(){if(aG){am.append(b('<div class="jspHorizontalBar" />').append(b('<div class="jspCap jspCapLeft" />'),b('<div class="jspTrack" />').append(b('<div class="jspDrag" />').append(b('<div class="jspDragLeft" />'),b('<div class="jspDragRight" />'))),b('<div class="jspCap jspCapRight" />')));an=am.find(">.jspHorizontalBar");H=an.find(">.jspTrack");i=H.find(">.jspDrag");if(aA.showArrows){az=b('<a class="jspArrow jspArrowLeft" />').bind("mousedown.jsp",aF(-1,0)).bind("click.jsp",aD);y=b('<a class="jspArrow jspArrowRight" />').bind("mousedown.jsp",aF(1,0)).bind("click.jsp",aD);
if(aA.arrowScrollOnHover){az.bind("mouseover.jsp",aF(-1,0,az));y.bind("mouseover.jsp",aF(1,0,y))}al(H,aA.horizontalArrowPositions,az,y)}i.hover(function(){i.addClass("jspHover")},function(){i.removeClass("jspHover")}).bind("mousedown.jsp",function(aL){b("html").bind("dragstart.jsp selectstart.jsp",aD);i.addClass("jspActive");var s=aL.pageX-i.position().left;b("html").bind("mousemove.jsp",function(aM){W(aM.pageX-s,false)}).bind("mouseup.jsp mouseleave.jsp",ay);return false});m=am.innerWidth();ah()}}function ah(){am.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){m-=b(this).outerWidth()});H.width(m+"px");aa=0}function G(){if(aG&&aB){var aL=H.outerHeight(),s=aq.outerWidth();u-=aL;b(an).find(">.jspCap:visible,>.jspArrow").each(function(){m+=b(this).outerWidth()});m-=s;w-=s;ak-=aL;H.parent().append(b('<div class="jspCorner" />').css("width",aL+"px"));p();ah()}if(aG){Y.width((am.outerWidth()-g)+"px")}Z=Y.outerHeight();r=Z/w;if(aG){au=Math.ceil(1/z*m);if(au>aA.horizontalDragMaxWidth){au=aA.horizontalDragMaxWidth}else{if(au<aA.horizontalDragMinWidth){au=aA.horizontalDragMinWidth}}i.width(au+"px");k=m-au;ae(aa)}if(aB){B=Math.ceil(1/r*u);if(B>aA.verticalDragMaxHeight){B=aA.verticalDragMaxHeight}else{if(B<aA.verticalDragMinHeight){B=aA.verticalDragMinHeight}}aw.height(B+"px");j=u-B;ad(J)}}function al(aM,aO,aL,s){var aQ="before",aN="after",aP;if(aO=="os"){aO=/Mac/.test(navigator.platform)?"after":"split"}if(aO==aQ){aN=aO}else{if(aO==aN){aQ=aO;aP=aL;aL=s;s=aP}}aM[aQ](aL)[aN](s)}function aF(aL,s,aM){return function(){I(aL,s,this,aM);this.blur();return false}}function I(aO,aN,aR,aQ){aR=b(aR).addClass("jspActive");var aP,aM,aL=true,s=function(){if(aO!==0){Q.scrollByX(aO*aA.arrowButtonSpeed)}if(aN!==0){Q.scrollByY(aN*aA.arrowButtonSpeed)}aM=setTimeout(s,aL?aA.initialDelay:aA.arrowRepeatFreq);aL=false};s();aP=aQ?"mouseout.jsp":"mouseup.jsp";aQ=aQ||b("html");aQ.bind(aP,function(){aR.removeClass("jspActive");aM&&clearTimeout(aM);aM=null;aQ.unbind(aP);aI()})}function q(){x();if(aB){aq.bind("mousedown.jsp",function(aQ){if(aQ.originalTarget===c||aQ.originalTarget==aQ.currentTarget){var aO=b(this),aR=aO.offset(),aP=aQ.pageY-aR.top-J,aM,aL=true,s=function(){var aU=aO.offset(),aV=aQ.pageY-aU.top-B/2,aS=w*aA.scrollPagePercent,aT=j*aS/(Z-w);if(aP<0){if(J-aT>aV){Q.scrollByY(-aS)}else{V(aV)}}else{if(aP>0){if(J+aT<aV){Q.scrollByY(aS)}else{V(aV)}}else{aN();return}}aM=setTimeout(s,aL?aA.initialDelay:aA.trackClickRepeatFreq);aL=false},aN=function(){aM&&clearTimeout(aM);aM=null;b(document).unbind("mouseup.jsp",aN);aI()};s();b(document).bind("mouseup.jsp",aN);return false}})}if(aG){H.bind("mousedown.jsp",function(aQ){if(aQ.originalTarget===c||aQ.originalTarget==aQ.currentTarget){var aO=b(this),aR=aO.offset(),aP=aQ.pageX-aR.left-aa,aM,aL=true,s=function(){var aU=aO.offset(),aV=aQ.pageX-aU.left-au/2,aS=ak*aA.scrollPagePercent,aT=k*aS/(T-ak);if(aP<0){if(aa-aT>aV){Q.scrollByX(-aS)}else{W(aV)}}else{if(aP>0){if(aa+aT<aV){Q.scrollByX(aS)}else{W(aV)}}else{aN();return}}aM=setTimeout(s,aL?aA.initialDelay:aA.trackClickRepeatFreq);aL=false},aN=function(){aM&&clearTimeout(aM);aM=null;b(document).unbind("mouseup.jsp",aN);aI()};s();b(document).bind("mouseup.jsp",aN);return false}})}}function x(){if(H){H.unbind("mousedown.jsp")}if(aq){aq.unbind("mousedown.jsp")}}function ay(){b("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp");if(aw){aw.removeClass("jspActive")}if(i){i.removeClass("jspActive")}aI()}function V(s,aL){if(!aB){return}if(s<0){s=0}else{if(s>j){s=j}}if(aL===c){aL=aA.animateScroll}if(aL){Q.animate(aw,"top",s,ad)}else{aw.css("top",s);ad(s)}}function ad(aL){if(aL===c){aL=aw.position().top}am.scrollTop(0);J=aL;var aO=J===0,aM=J==j,aN=aL/j,s=-aN*(Z-w);if(aj!=aO||aJ!=aM){aj=aO;aJ=aM;E.trigger("jsp-arrow-change",[aj,aJ,P,l])}v(aO,aM);Y.css("top",s);E.trigger("jsp-scroll-y",[-s,aO,aM]).trigger("scroll")}function W(aL,s){if(!aG){return}if(aL<0){aL=0}else{if(aL>k){aL=k}}if(s===c){s=aA.animateScroll}if(s){Q.animate(i,"left",aL,ae)
}else{i.css("left",aL);ae(aL)}}function ae(aL){if(aL===c){aL=i.position().left}am.scrollTop(0);aa=aL;var aO=aa===0,aN=aa==k,aM=aL/k,s=-aM*(T-ak);if(P!=aO||l!=aN){P=aO;l=aN;E.trigger("jsp-arrow-change",[aj,aJ,P,l])}t(aO,aN);Y.css("left",s);E.trigger("jsp-scroll-x",[-s,aO,aN]).trigger("scroll")}function v(aL,s){if(aA.showArrows){ar[aL?"addClass":"removeClass"]("jspDisabled");af[s?"addClass":"removeClass"]("jspDisabled")}}function t(aL,s){if(aA.showArrows){az[aL?"addClass":"removeClass"]("jspDisabled");y[s?"addClass":"removeClass"]("jspDisabled")}}function M(s,aL){var aM=s/(Z-w);V(aM*j,aL)}function N(aL,s){var aM=aL/(T-ak);W(aM*k,s)}function ab(aX,aS,aM){var aQ,aN,aO,s=0,aW=0,aL,aR,aU,aT,aV;try{aQ=b(aX)}catch(aP){return}aN=aQ.outerHeight();aO=aQ.outerWidth();am.scrollTop(0);am.scrollLeft(0);while(!aQ.is(".jspPane")){s+=aQ.position().top;aW+=aQ.position().left;aQ=aQ.offsetParent();if(/^body|html$/i.test(aQ[0].nodeName)){return}}aL=aC();aR=aL+w;if(s<aL||aS){aT=s-aA.verticalGutter}else{if(s+aN>aR){aT=s-w+aN+aA.verticalGutter}}if(aT){M(aT,aM)}viewportLeft=aE();aU=viewportLeft+ak;if(aW<viewportLeft||aS){aV=aW-aA.horizontalGutter}else{if(aW+aO>aU){aV=aW-ak+aO+aA.horizontalGutter}}if(aV){N(aV,aM)}}function aE(){return -Y.position().left}function aC(){return -Y.position().top}function ag(){am.unbind(ac).bind(ac,function(aO,aP,aN,aL){var aM=aa,s=J;Q.scrollBy(aN*aA.mouseWheelSpeed,-aL*aA.mouseWheelSpeed,false);return aM==aa&&s==J})}function o(){am.unbind(ac)}function aD(){return false}function K(){Y.find(":input,a").unbind("focus.jsp").bind("focus.jsp",function(s){ab(s.target,false)})}function F(){Y.find(":input,a").unbind("focus.jsp")}function S(){var s;Y.focus(function(){E.focus()});E.attr("tabindex",0).unbind("keydown.jsp keyup.jsp keypress.jsp").bind("keydown.jsp",function(aQ){if(aQ.target!==this){return}var aP=aa,aO=J;switch(aQ.keyCode){case 40:case 38:case 34:case 32:case 33:case 39:case 37:C=aQ.keyCode;aL();break;case 35:M(Z-w);C=null;break;case 36:M(0);C=null;break}s=aQ.keyCode==C&&aP!=aa||aO!=J;return !s}).bind("keyup.jsp",function(aO){aN()}).bind("keypress.jsp",function(aO){if(aO.keyCode==C){aL()}return !s});if(aA.hideFocus){E.css("outline","none");if("hideFocus" in am[0]){E.attr("hideFocus",true)}}else{E.css("outline","");if("hideFocus" in am[0]){E.attr("hideFocus",false)}}function aL(){var aP=aa,aO=J;switch(C){case 40:Q.scrollByY(aA.keyboardSpeed,false);break;case 38:Q.scrollByY(-aA.keyboardSpeed,false);break;case 34:case 32:Q.scrollByY(w*aA.scrollPagePercent,false);break;case 33:Q.scrollByY(-w*aA.scrollPagePercent,false);break;case 39:Q.scrollByX(aA.keyboardSpeed,false);break;case 37:Q.scrollByX(-aA.keyboardSpeed,false);break}s=aP!=aa||aO!=J;return s}function aM(aO){av=setTimeout(function(){aM()},aO?aA.initialDelay:aA.keyboardRepeatFreq);if(!aL()){aN()}}function aN(){s=false;C=null;av&&clearTimeout(av);av=null}}function R(){E.attr("tabindex","-1").removeAttr("tabindex").unbind("keydown.jsp keyup.jsp keypress.jsp")}function D(){if(location.hash&&location.hash.length>1){var aM,aL;try{aM=b(location.hash)}catch(s){return}if(aM.length&&Y.find(location.hash)){if(am.scrollTop()===0){aL=setInterval(function(){if(am.scrollTop()>0){ab(location.hash,true);b(document).scrollTop(am.position().top);clearInterval(aL)}},50)}else{ab(location.hash,true);b(document).scrollTop(am.position().top)}}}}function ai(){b("a.jspHijack").unbind("click.jsp-hijack").removeClass("jspHijack")}function n(){ai();b("a[href^=#]").addClass("jspHijack").bind("click.jsp-hijack",function(){var s=this.href.split("#"),aL;if(s.length>1){aL=s[1];if(aL.length>0&&Y.find("#"+aL).length>0){ab("#"+aL,true);return false}}})}function aI(){if(!b(":focus").length){E.focus()}}function ao(){var aM,aL,aO,aN,aP,s=false;am.unbind("touchstart.jsp touchmove.jsp touchend.jsp click.jsp-touchclick").bind("touchstart.jsp",function(aQ){var aR=aQ.originalEvent.touches[0];aM=aE();aL=aC();aO=aR.pageX;aN=aR.pageY;aP=false;s=true}).bind("touchmove.jsp",function(aT){if(!s){return}var aS=aT.originalEvent.touches[0],aR=aa,aQ=J;
Q.scrollTo(aM+aO-aS.pageX,aL+aN-aS.pageY);aP=aP||Math.abs(aO-aS.pageX)>5||Math.abs(aN-aS.pageY)>5;return aR==aa&&aQ==J}).bind("touchend.jsp",function(aQ){s=false}).bind("click.jsp-touchclick",function(aQ){if(aP){aP=false;return false}})}function h(){var s=aC(),aL=aE();E.removeClass("jspScrollable").unbind(".jsp");E.replaceWith(ap.append(Y.children()));ap.scrollTop(s);ap.scrollLeft(aL)}b.extend(Q,{reinitialise:function(aL){aL=b.extend({},aA,aL);at(aL)},scrollToElement:function(aM,aL,s){ab(aM,aL,s)},scrollTo:function(aM,s,aL){N(aM,aL);M(s,aL)},scrollToX:function(aL,s){N(aL,s)},scrollToY:function(s,aL){M(s,aL)},scrollToPercentX:function(aL,s){N(aL*(T-ak),s)},scrollToPercentY:function(aL,s){M(aL*(Z-w),s)},scrollBy:function(aL,s,aM){Q.scrollByX(aL,aM);Q.scrollByY(s,aM)},scrollByX:function(s,aM){var aL=aE()+s,aN=aL/(T-ak);W(aN*k,aM)},scrollByY:function(s,aM){var aL=aC()+s,aN=aL/(Z-w);V(aN*j,aM)},positionDragX:function(s,aL){W(s,aL)},positionDragY:function(aL,s){W(aL,s)},animate:function(aL,aO,s,aN){var aM={};aM[aO]=s;aL.animate(aM,{duration:aA.animateDuration,ease:aA.animateEase,queue:false,step:aN})},getContentPositionX:function(){return aE()},getContentPositionY:function(){return aC()},getContentWidth:function(){return T()},getContentHeight:function(){return Z()},getPercentScrolledX:function(){return aE()/(T-ak)},getPercentScrolledY:function(){return aC()/(Z-w)},getIsScrollableH:function(){return aG},getIsScrollableV:function(){return aB},getContentPane:function(){return Y},scrollToBottom:function(s){V(j,s)},hijackInternalLinks:function(){n()},destroy:function(){h()}});at(O)}f=b.extend({},b.fn.jScrollPane.defaults,f);b.each(["mouseWheelSpeed","arrowButtonSpeed","trackClickSpeed","keyboardSpeed"],function(){f[this]=f[this]||f.speed});var e;this.each(function(){var g=b(this),h=g.data("jsp");if(h){h.reinitialise(f)}else{h=new d(g,f);g.data("jsp",h)}e=e?e.add(g):g});return e};b.fn.jScrollPane.defaults={showArrows:false,maintainPosition:true,clickOnTrack:true,autoReinitialise:false,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,animateScroll:false,animateDuration:300,animateEase:"linear",hijackInternalLinks:false,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:0,arrowButtonSpeed:0,arrowRepeatFreq:50,arrowScrollOnHover:false,trackClickSpeed:0,trackClickRepeatFreq:70,verticalArrowPositions:"split",horizontalArrowPositions:"split",enableKeyboardNavigation:true,hideFocus:false,keyboardSpeed:0,keyboardRepeatFreq:50,initialDelay:300,speed:30,scrollPagePercent:0.8}})(jQuery,this);