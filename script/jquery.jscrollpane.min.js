/*
 * jScrollPane - v2.0.0beta1 - 2010-08-06
 * http://jscrollpane.kelvinluck.com/
 *
 * Copyright (c) 2010 Kelvin Luck
 * Dual licensed under the MIT and GPL licenses.
 */
(function(b,a,c){b.fn.jScrollPane=function(f){function d(ad,ab){var ai,h=this,aa,I,R,an,V,ah,Z,E,q,al,m,W,A,p,ak,D,P,ac,U,o,S,C,X,F,H,O,n,K,y,aj,z;I={};J(ab);function J(aq){var aw,av,au,ar,at,ap,ao;ai=aq;if(aa==c){ad.css("overflow","hidden");R=ad.innerWidth();an=ad.innerHeight();aa=b('<div class="jspPane" />').wrap(b('<div class="jspContainer" />').css({width:R+"px",height:an+"px"}));ad.css("overflow","visible");ad.wrap(aa.parent());aa=ad.parent();V=aa.parent();au=ad.find(":first-child");ar=ad.find(":last-child");V.css({"margin-top":au.css("margin-top"),"margin-bottom":ar.css("margin-bottom")});au.css("margin-top",0);ar.css("margin-bottom",0)}else{if(ad.outerWidth()==ah&&ad.outerHeight()==Z){return}R=V.outerWidth();an=V.outerHeight();V.find(".jspVerticalBar,.jspHorizontalBar").remove().end()}ad.css({width:"auto",height:"auto"});aw=ad.clone().css("position","absolute");av=b('<div style="width:1px; position: relative;" />').append(aw);b("body").append(av);ah=Math.max(ad.outerWidth(),aw.outerWidth());av.remove();Z=ad.outerHeight();E=ah/R;q=Z/an;al=q>1;m=E>1;if(!(m||al)){ad.removeClass("jspScrollable");aa.css("top",0);Q();r();u()}else{ad.addClass("jspScrollable");at=ai.maintainPosition&&(p||P);if(at){ap=j();ao=g()}x();af();k();if(at){w(ap);v(ao)}t();am();if(ai.hijackInternalLinks){i()}}if(ai.autoReinitialise&&!z){z=setInterval(function(){J(ai)},ai.autoReinitialiseDelay)}else{if(!ai.autoReinitialise&&z){clearInterval(z)}}}function x(){if(al){V.append(b('<div class="jspVerticalBar" />').append(b('<div class="jspCap jspCapTop" />'),b('<div class="jspTrack" />').append(b('<div class="jspDrag" />').append(b('<div class="jspDragTop" />'),b('<div class="jspDragBottom" />'))),b('<div class="jspCap jspCapBottom" />')));ac=V.find(">.jspVerticalBar");U=ac.find(">.jspTrack");W=U.find(">.jspDrag");if(ai.showArrows){X=b('<a href="#" class="jspArrow jspArrowUp">Scroll up</a>').bind("mousedown.jsp",G(0,-1)).bind("click.jsp",ae);F=b('<a href="#" class="jspArrow jspArrowDown">Scroll down</a>').bind("mousedown.jsp",G(0,1)).bind("click.jsp",ae);U.before(X).after(F)}S=an;V.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){S-=b(this).outerHeight()});W.hover(function(){W.addClass("jspHover")},function(){W.removeClass("jspHover")}).bind("mousedown.jsp",function(ao){b("html").bind("dragstart.jsp selectstart.jsp",function(){return false});var s=ao.pageY-W.position().top;b("html").bind("mousemove.jsp",function(ap){L(ap.pageY-s)}).bind("mouseup.jsp mouseleave.jsp",B);return false});N();l()}else{Q()}}function N(){U.height(S+"px");p=0;o=ai.verticalGutter+U.outerWidth();aa.width(R-o);if(ac.position().left==0){aa.css("margin-left",o+"px")}}function af(){if(m){V.append(b('<div class="jspHorizontalBar" />').append(b('<div class="jspCap jspCapLeft" />'),b('<div class="jspTrack" />').append(b('<div class="jspDrag" />').append(b('<div class="jspDragLeft" />'),b('<div class="jspDragRight" />'))),b('<div class="jspCap jspCapRight" />')));H=V.find(">.jspHorizontalBar");O=H.find(">.jspTrack");ak=O.find(">.jspDrag");if(ai.showArrows){y=b('<a href="#" class="jspArrow jspArrowLeft">Scroll left</a>').bind("mousedown.jsp",G(-1,0)).bind("click.jsp",ae);aj=b('<a href="#" class="jspArrow jspArrowRight">Scroll right</a>').bind("mousedown.jsp",G(1,0)).bind("click.jsp",ae);O.before(y).after(aj)}ak.hover(function(){ak.addClass("jspHover")},function(){ak.removeClass("jspHover")}).bind("mousedown.jsp",function(ao){b("html").bind("dragstart.jsp selectstart.jsp",function(){return false});var s=ao.pageX-ak.position().left;b("html").bind("mousemove.jsp",function(ap){M(ap.pageX-s)}).bind("mouseup.jsp mouseleave.jsp",B);return false});n=V.innerWidth();Y()}else{}}function Y(){aa.height(an-ai.horizontalGutter-O.outerHeight());V.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){n-=b(this).outerWidth()
});O.width(n+"px");P=0}function k(){if(m&&al){var ao=O.outerHeight(),s=U.outerWidth();S-=ao;b(H).find(">.jspCap:visible,>.jspArrow").each(function(){n+=b(this).outerWidth()});n-=s;an-=s;R-=ao;O.parent().append(b('<div class="jspCorner" />').css("width",ao+"px"));N();Y()}if(m){aa.width(V.outerWidth()+"px")}Z=ad.outerHeight();q=Z/an;if(m){K=1/E*n;if(K>ai.horizontalDragMaxWidth){K=ai.horizontalDragMaxWidth}else{if(K<ai.horizontalDragMinWidth){K=ai.horizontalDragMinWidth}}ak.width(K+"px");D=n-K}if(al){C=1/q*S;if(C>ai.verticalDragMaxHeight){C=ai.verticalDragMaxHeight}else{if(C<ai.verticalDragMinHeight){C=ai.verticalDragMinHeight}}W.height(C+"px");A=S-C}}function G(ao,s){return function(){ag(ao,s);this.blur();return false}}function ag(ap,s){var ao=setInterval(function(){if(ap!=0){M(P+ap*ai.arrowButtonSpeed)}if(s!=0){L(p+s*ai.arrowButtonSpeed)}},ai.arrowRepeatFreq);b("html").bind("mouseup.jsp",function(){clearInterval(ao);b("html").unbind("mouseup.jsp")})}function B(){b("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp")}function L(s){if(!al){return}if(s<0){s=0}else{if(s>A){s=A}}p=s;W.css("top",s);V.scrollTop(0);var ao=s/A;aa.css("top",-ao*(Z-an))}function M(s){if(!m){return}if(s<0){s=0}else{if(s>D){s=D}}P=s;ak.css("left",s);V.scrollTop(0);var ao=s/D;aa.css("left",-ao*(ah-R))}function v(s){var ao=s/(Z-an);L(ao*A)}function w(s){var ao=s/(ah-R);M(ao*D)}function T(aw,au){var ar,ap,s=0,ao,at,av;try{ar=b(aw)}catch(aq){return}ap=ar.outerHeight();V.scrollTop(0);while(!ar.is(".jspPane")){s+=ar.position().top;ar=ar.offsetParent();if(/^body|html$/i.test(ar[0].nodeName)){return}}ao=g();at=ao+an;if(s<ao||au){av=s-ai.verticalGutter}else{if(s+ap>at){av=s-an+ap+ai.verticalGutter}}if(av){v(av)}}function j(){return -aa.position().left}function g(){return -aa.position().top}function l(){V.bind("mousewheel.jsp",function(s,ap){var ao=p;L(p-ap*ai.mouseWheelSpeed);return ao==p})}function Q(){V.unbind("mousewheel.jsp")}function ae(){return false}function t(){ad.find(":input,a").bind("focus.jsp",function(){T(this,false)})}function r(){ad.find(":input,a").unbind("focus.jsp")}function am(){if(location.hash&&location.hash.length>1){var ap,ao;try{ap=b(location.hash)}catch(s){return}if(ap.length&&ad.find(ap)){if(V.scrollTop()==0){ao=setInterval(function(){if(V.scrollTop()>0){T(location.hash,true);b(document).scrollTop(V.position().top);clearInterval(ao)}},50)}else{T(location.hash,true);b(document).scrollTop(V.position().top)}}}}function u(){b("a[href^=#]").unbind("click.jsp-hijack")}function i(){b("a[href^=#]").unbind("click.jsp-hijack").bind("click.jsp-hijack",function(){var s=this.href.split("#"),ao;if(s.length>1){ao=s[1];if(ao.length>0&&ad.find("#"+ao).length>0){T("#"+ao,true);return false}}})}b.extend(h,{reinitialise:function(ao){ao=b.extend({},ao,ai);J(ao)},scrollToElement:function(ao,s){T(ao,s)},scrollTo:function(ao,s){w(ao);v(s)},scrollToX:function(s){w(s)},scrollToY:function(s){v(s)},scrollBy:function(ao,s){h.scrollByX(ao);h.scrollByY(s)},scrollByX:function(s){var ao=j()+s,ap=ao/(ah-R);M(ap*D)},scrollByY:function(s){var ao=g()+s,ap=ao/(Z-an);L(ap*A)},contentPositionX:function(){return j()},contentPositionY:function(){return g()},scrollToBottom:function(){L(A)},hijackInternalLinks:function(){i()}})}f=b.extend({},b.fn.jScrollPane.defaults,f);var e;this.each(function(){var g=b(this),h=g.data("jsp");if(h){h.reinitialise(f)}else{h=new d(g,f);g.data("jsp",h)}e=e?e.add(g):g});return e};b.fn.jScrollPane.defaults={showArrows:false,maintainPosition:true,autoReinitialise:false,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,hijackInternalLinks:false,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:10,arrowButtonSpeed:10,arrowRepeatFreq:100}})(jQuery,this);